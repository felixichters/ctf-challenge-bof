import threading
import time
import requests

PASSWORD_FILE = "/home/navi/Uni/it-sec/iap/container-b/passwd"
KNOWN_PASSWORD = "password123"
KNOWN_HASH = "482c811da5d5b4bc6d497ffa98491e38"  # MD5("password123")
AUTH_URL = "http://localhost:5000/auth"

def write_known_hash():
    while True:
        try:
            with open(PASSWORD_FILE, "w") as f:
                f.write(KNOWN_HASH)
        except Exception as e:
            print(f"Error writing to file: {e}")
            break

def submit_password():
    payload = {"password": KNOWN_PASSWORD}
    while True:
        try:
            response = requests.post(AUTH_URL, json=payload)
            if response.status_code == 200:
                print("Success! Flag:", response.json().get("flag"))
                break
            else:
                print("Attempt failed:", response.json().get("error"))
        except Exception as e:
            print(f"Error communicating with the server: {e}")
        time.sleep(0.5)

if __name__ == "__main__":
    writer_thread = threading.Thread(target=write_known_hash, daemon=True)
    writer_thread.start()

    submit_password()

